!function(){var __hasProp={}.hasOwnProperty,__extends=function(t,e){function r(){this.constructor=t}for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};!function t(e,r,o){function n(a,c){if(!r[a]){if(!e[a]){var s="function"==typeof require&&require;if(!c&&s)return s(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+a+"'")}var p=r[a]={exports:{}};e[a][0].call(p.exports,function(t){var r=e[a][1][t];return n(r?r:t)},p,p.exports,t,e,r,o)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)n(o[a]);return n}({1:[function(t,e){var r,o;o=t("./MacroSet"),r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.install=function(t){e.__super__.install.call(this,t),this.addMacro("reference",this.macroReference),this.addMacro("events",this.macroEvents),this.addMacro("component",this.macroComponent),this.addMacro("baseCls",this.macroBaseCls)},e.prototype.macroReference=function(t){return'html:miwo-reference="'+t+'"'},e.prototype.macroEvents=function(t){return t=t.replace(/([a-zA-Z0-9]+):'?([a-zA-Z0-9]+)'?/g,"$1:\\'$2\\'"),'html:miwo-events="{'+t+'}"'},e.prototype.macroComponent=function(t){return"html:<div miwo-component=\"'+ (typeof "+t+'!="undefined" && Type.isObject('+t+") ? "+t+'.name : "'+t+'") +\'"></div>'},e.prototype.macroBaseCls=function(t){return'string:me.getBaseCls("'+t+'")'},e}(o),e.exports=r},{"./MacroSet":7}],2:[function(t,e){var r,o;o=t("./MacroSet"),r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.install=function(t){e.__super__.install.call(this,t),this.addMacro("if",this.macroIf,this.macroEnd),this.addMacro("elseif",this.macroElseIf),this.addMacro("else",this.macroElse),this.addMacro("ifset",this.macroIfSet),this.addMacro("elseifset",this.macroElseIfSet),this.addMacro("for",this.macroFor,this.macroEnd),this.addMacro("js",this.macroJs),this.addMacro("log",this.macroLog),this.addMacro("=",this.macroWrite),this.addMacro("_",this.macroTranslate)},e.prototype.macroEnd=function(){return"}"},e.prototype.macroIf=function(t){return"if("+t+") {"},e.prototype.macroElseIf=function(t){return"} else if("+t+") {"},e.prototype.macroElse=function(){return"} else {"},e.prototype.macroIfSet=function(t){return this.macroIf("("+t+") !== undefined && ("+t+") !== null)")},e.prototype.macroElseIfSet=function(t){return this.macroElseIf("("+t+") !== undefined && ("+t+") !== null)")},e.prototype.macroFor=function(t){var e,r,o,n,i;return(r=t.match(/([\S]+)\s+in\s+([\S]+)/))?(o=r[1],n=r[2],"_items = "+n+"; for(var _i=0,_l=_items.length; _i<_l; _i++) { var "+o+" = _items[_i];"):(r=t.match(/([\S]+),\s*([\S]+)\s+in\s+([\S]+)/))?(o=r[1],e=r[2],n=r[3],"_items = "+n+"; for(var "+e+"=0,"+e+"_l=_items.length; "+e+"<"+e+"_l; "+e+"++) { var "+o+" = _items["+e+"];"):(r=t.match(/([\S]+),\s*([\S]+)\s+of\s+([\S]+)/))?(o=r[1],i=r[2],n=r[3],"_items = "+n+"; for(var "+o+" in _items) { var "+i+" = _items["+o+"];"):"for("+t+") {"},e.prototype.macroWrite=function(t){return"string:"+t},e.prototype.macroJs=function(t){return t+";"},e.prototype.macroLog=function(t){return"console.log("+t+");"},e.prototype.macroTranslate=function(t){var e,r;return e=t.match(/([\S]+)(\s+(.*))?/),r="",e?(r='"'===e[1].charAt(0)?"string:miwo.tr("+e[1]+")":'string:miwo.tr("'+e[1]+'")',e[3]&&(r+=".substitute({"+e[3].replace("\\","").replace("\\","")+"})"),r):r},e}(o),e.exports=r},{"./MacroSet":7}],3:[function(t,e){var r,o,n;n=t("./LatteFactory"),r=t("./LatteCompiler"),o=function(e){function o(){return o.__super__.constructor.apply(this,arguments)}return __extends(o,e),o.prototype.init=function(){this.setConfig({macros:{core:t("./CoreMacroSet"),component:t("./ComponentMacroSet")}})},o.prototype.build=function(t){t.define("latteFactory",n,function(){return function(){}}(this)),t.define("latteCompiler",r,function(t){return function(e){var r,o,n,i;i=t.config.macros;for(n in i)o=i[n],r=new o,r.install(e)}}(this)),t.define("templateRendererFactory",n).setFactory(function(){return function(){return t.get("latteFactory")}}(this))},o}(Miwo.di.InjectorExtension),e.exports=o},{"./ComponentMacroSet":1,"./CoreMacroSet":2,"./LatteCompiler":5,"./LatteFactory":6}],4:[function(require,module,exports){var Latte;Latte=function(){function Latte(t){this.compiler=t,this.filters={}}return Latte.prototype.source=null,Latte.prototype.compiled=null,Latte.prototype.filters=null,Latte.prototype.compiler=null,Latte.prototype.setFilter=function(t,e){this.filters[t]=e},Latte.prototype.setSource=function(t){this.source=t},Latte.prototype.render=function(t){var e;if(!this.compiled)try{this.compiled=this.compiler.compile(this,this.source)}catch(r){e=r,console.error("Latte compile error:",e.stack," in compiling template:\n\n",this.source),this.compiled=null}return this.compiled?this.evaluate(this.compiled,t):"LATTE_ERROR"},Latte.prototype.evaluate=function(string,params){var e,filters,name,template,_tpl;try{_tpl="",filters=this.filters,template=this;for(name in params)eval("var "+name+' = params["'+name+'"];');return eval(string),_tpl}catch(_error){return e=_error,console.error("Latte render error:",e.stack," in template:\n\n",string),""}},Latte}(),module.exports=Latte},{}],5:[function(t,e){var r;r=function(){function t(){}return t.prototype.macros={},t.prototype.addMacro=function(t,e){return this.macros[t]=e,this},t.prototype.addMacros=function(t){var e,r;for(r in t)e=t[r],this.addMacro(r,e);return this},t.prototype.compile=function(t,e){var r,o;return r="",o=this.beforeCompile(e),r+=this.start(),r+=o.replace(/\{([^\}]+)\}/g,function(t){return function(e,o){return r=t.compileCode(o),r!==!1?r:o}}(this)),r+=this.end(),r=this.afterCompile(r)},t.prototype.start=function(){return"var _tpl = '"},t.prototype.end=function(){return"';"},t.prototype.compileCode=function(t){var e,r,o,n;return o=t.match(/^(\/)?(\S+)\s?(.*)$/),r=o[1],n=o[2],e=o[3],e=e.replace("&gt;",">"),e=e.replace("&lt;",">"),e=e.replace("@","me."),e&&(e=e.replace(/([^\|]+)\|(.+)/g,function(){return function(t,e,r){var n,i,a,c,s;for(n=e,s=r.split("|"),a=0,c=s.length;c>a;a++)i=s[a],o=i.match(/([^:]+)(:(.*))?/),n="filters."+o[1]+"("+n+(o[3]?","+o[3]:"")+")";return n}}(this))),this.writeMacro(n,e,r)},t.prototype.beforeCompile=function(t){return t=t.replace(/'/g,"\\'"),t=t.replace(/\n/g,""),t=t.replace(/\r/g,""),t=t.replace(/\{\*.*\*\}/g,"")},t.prototype.afterCompile=function(t){return t=t.replace(/>\s+</g,"> <"),t=t.replace(/>\s+\';/g,">';"),t=t.replace(/(_tpl\+?=')\s+/g,"$1"),t=t.replace(/_tpl\+=\'\s*\';/g,"")},t.prototype.writeMacro=function(t,e,r){var o,n;if(!this.macros[t])throw new Error("Undefined macro "+t);return n=this.macros[t],o="",o=r?n.nodeClosed(t,e):n.nodeOpened(t,e),this.writeCode(o)},t.prototype.writeCode=function(t){var e,r,o;return(r=t.match(/(string|js|html):(.*)/))?(o=r[1],e=r[2]):(o="js",e=t),this.write(o,e)},t.prototype.write=function(t,e){var r;if(!e)return"";switch(t){case"string":r="'+"+e+"+'";break;case"js":r="'; "+e+" _tpl+='";break;case"html":r=e}return r},t}(),e.exports=r},{}],6:[function(t,e){var r,o;r=t("./Latte"),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.latteCompiler=e.inject("latteCompiler"),e.prototype.create=function(){return new r(this.latteCompiler)},e}(Miwo.Object),e.exports=o},{"./Latte":4}],7:[function(t,e){var r;r=function(){function t(){}return t.prototype.macros={},t.prototype.compiler=null,t.prototype.install=function(t){this.compiler=t},t.prototype.addMacro=function(t,e,r){this.macros[t]=[e,r],this.compiler.addMacro(t,this)},t.prototype.start=function(){},t.prototype.end=function(){},t.prototype.nodeOpened=function(t,e){return this.macros[t][0](e)},t.prototype.nodeClosed=function(t,e){return this.macros[t][1](e)},t}(),e.exports=r},{}],8:[function(t){Miwo.latte={MacroSet:t("./MacroSet"),LatteCompiler:t("./LatteCompiler"),LatteFactory:t("./LatteFactory")},miwo.registerExtension("miwo-latte",t("./DiExtension"))},{"./DiExtension":3,"./LatteCompiler":5,"./LatteFactory":6,"./MacroSet":7}]},{},[8])}();